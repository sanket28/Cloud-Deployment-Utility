<!DOCTYPE html>
<html>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
{% load staticfiles %}
<link rel="stylesheet" type="text/css" href="{% static "css/styles.css" %}">
<script src="{% static "js/app.js" %}"></script>
<script src="{% static "js/mqtt.js" %}"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

<body>
	<!--div class="container"-->
		<div class="header">
			<div style="margin-top:1%; margin-left:0.5%;">Cloud Deployment Utility</div>
		</div>
		<div class="content">
			<div class="statusTitle">
				<h2><strong>Deployment status</strong><h2>
			</div>
			<div class="scroll" id="message"></div>
		</div>
		<div class="footer">
			<img src="{% static "images/northeastern.png" %}" height="60" width="240" style="float:right; margin-top:1%; margin-right:1%;">
		</div>
		<script>
			// This block of code connects to the MQTT server running on the management server. It is subscribed to the 
			// 'cs8674/InstallStatus' topic. The shell script will send diagonstic messages to this topic which will
			// populate on the web page
			var hostname = "192.168.1.42"; // MQTT server address
			var port = 9001;
			var clientid = "cs8674-status";
			var client = new Paho.MQTT.Client(hostname, port, clientid); // MQTT client object

			var options = { 
			     //connection attempt timeout in seconds
			     timeout: 10,
			 
			     //Gets Called if the connection has successfully been established
			     onSuccess: function () {
			         client.subscribe("cs8674/InstallStatus", {qos: 0}); // Subscribe to the 'cs8674/InstallStatus' topic
			     },
			 
			     //Gets Called if the connection could not be established
			     onFailure: function (message) {
			         alert("Connection failed: " + message.errorMessage);
			     }			 
			};

 			client.onMessageArrived = onMessageArrived; // Set up callback for when messages arrive on the subscribed topic
 			client.onConnectionLost = onConnectionLost; // Callback for when connection is lost
 
			//Attempt to connect
			client.connect(options);

			function onConnectionLost(responseObject) {
			  if (responseObject.errorCode !== 0) {
			    console.log("onConnectionLost:"+responseObject.errorMessage);
			  }
			}

			function onMessageArrived(message) {
			  var div = document.getElementById('message'); // Get the deployment status div by its ID

			  if(message.payloadString === "Done!") {
			  	div.innerHTML = div.innerHTML + message.payloadString; // If 'Done!' is receieved don't create a new line
			  } else {
			  	div.innerHTML = div.innerHTML + '<br />' + message.payloadString;
			  }
			}
		</script>
	<!--/div-->
</body>
</html>